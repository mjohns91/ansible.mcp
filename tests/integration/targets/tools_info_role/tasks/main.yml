---
- name: Configure host
  ansible.builtin.add_host:
    name: github-mcp-server
    ansible_connection: ansible.mcp.mcp
    ansible_mcp_server_name: github
    ansible_mcp_bearer_token: "{{ github_mcp_pat }}"
    ansible_mcp_manifest_path: "{{ role_path }}/files/manifest.json"

- name: Run ansible.mcp.tools_info
  ansible.mcp.tools_info:
  register: result
  delegate_to: github-mcp-server

- name: Validate that the module response is as expected
  ansible.builtin.assert:
    that:
      - '"tools" in result'
      - result.tools | length > 0
      - result.tools | selectattr('name', 'equalto', 'pull_request_read') | list | length == 1
